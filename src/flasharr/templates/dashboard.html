{% extends "base.html" %}

{% block title %}Dashboard - Fshare Nexus{% endblock %}

{% block header_content %}
<div class="search-container" style="width: 300px;">
    <input type="text" class="search-input" placeholder="Search Fshare..." id="header-search-input" autocomplete="off"
        style="background: var(--surface); border: 1px solid var(--outline);">
    <div class="autocomplete-dropdown" id="autocomplete-dropdown"></div>
</div>
{% endblock %}

{% block content %}
<div class="dashboard-stats-container">

    <!-- Row 1: Real-time Speed Graph (Main Feature) -->
    <div class="stats-card large-card graph-card">
        <div class="card-header">
            <h3>NetFlow</h3>
            <div class="speed-legend">
                <span class="legend-item down"><span class="dot"></span> Download: <span id="dash-down-val">0
                        MB/s</span></span>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="networkChart"></canvas>
        </div>
    </div>

    <!-- Row 2: Info Grid -->
    <div class="stats-grid" style="grid-template-columns: 1fr 1fr; gap: 1.5rem;">

        <!-- Account Information -->
        <div class="stats-card account-card">
            <div class="card-header">
                <h3>Account Information</h3>
            </div>
            <div class="card-body" style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div class="account-badge-row"
                    style="display: flex; align-items: center; justify-content: space-between;">
                    <span class="label" style="color: var(--text-muted);">Account Type</span>
                    <div class="account-badge" id="dash-account-badge"
                        style="display: flex; align-items: center; gap: 0.5rem; background: rgba(29, 233, 182, 0.1); padding: 0.25rem 0.75rem; border-radius: 20px; color: var(--primary);">
                        <span class="material-icons" style="font-size: 18px;">stars</span>
                        <span class="badge-text" id="dash-account-type"
                            style="font-weight: 700; font-size: 0.85rem;">PREMIUM</span>
                    </div>
                </div>

                <div class="account-expiry-row"
                    style="display: flex; align-items: center; justify-content: space-between;">
                    <span class="label" style="color: var(--text-muted);">Expiry Date</span>
                    <span class="value highlight-text" id="dash-expiry" style="font-weight: 500;">--</span>
                </div>

                <div class="quota-section">
                    <div
                        style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.85rem;">
                        <span style="color: var(--text-muted);">Daily Quota</span>
                        <span id="dash-quota-text" style="color: var(--text-color);">-- / --</span>
                    </div>
                    <div class="linear-progress"
                        style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                        <div class="progress-bar" id="dash-quota-bar"
                            style="width: 0%; background: var(--primary); height: 100%; transition: width 0.5s ease;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download Queue Status & Minified List -->
        <div class="stats-card queue-card" style="display: flex; flex-direction: column;">
            <div class="card-header" style="justify-content: space-between;">
                <h3>Download Queue</h3>
                <div class="queue-status-chips" style="display: flex; gap: 0.5rem;">
                    <div class="status-chip active"
                        style="font-size: 0.75rem; padding: 2px 8px; background: rgba(34, 197, 94, 0.1); color: #4ade80; border-radius: 4px;">
                        Active: <span id="dash-active-count" style="font-weight: bold;">0</span>
                    </div>
                    <div class="status-chip queued"
                        style="font-size: 0.75rem; padding: 2px 8px; background: rgba(255, 255, 255, 0.1); color: var(--text-muted); border-radius: 4px;">
                        Queue: <span id="dash-queue-count" style="font-weight: bold;">0</span>
                    </div>
                </div>
            </div>

            <div class="card-body"
                style="padding: 0; flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                <!-- Minified List Header -->
                <div class="minified-list-header"
                    style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); font-size: 0.75rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase;">
                    <div>File Name</div>
                    <div style="text-align: right;">Size</div>
                    <div>Progress</div>
                    <div style="text-align: right;">Speed</div>
                </div>

                <!-- Minified List Container -->
                <div id="dash-minified-queue" style="flex: 1; overflow-y: auto; max-height: 250px;">
                    <!-- Items will be injected here via JS -->
                    <div class="empty-placeholder"
                        style="padding: 2rem; text-align: center; color: var(--text-muted); font-size: 0.85rem;">
                        No active downloads
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Placeholder for chart initialization (will be moved to app.js later)
    document.addEventListener('DOMContentLoaded', () => {
        if (window.bridge) window.bridge.initDashboardCharts();
    });
</script>
{% endblock %}
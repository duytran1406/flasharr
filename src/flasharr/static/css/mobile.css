/* ==========================================================================
   Mobile Responsive Overrides (Max Width: 768px)
   ========================================================================== */
@media (max-width: 768px) {

    /* 1. Layout Adjustments */
    .app-wrapper {
        flex-direction: column;
        padding-bottom: 70px;
        /* Space for Bottom Nav */
        min-height: auto;
        /* Allow scrolling */
    }

    /* Hide Desktop Sidebar */
    .sidebar {
        display: none !important;
    }

    /* Full Width Content */
    .main-content,
    .sidebar.collapsed+.main-content {
        margin-left: 0 !important;
        width: 100% !important;
        padding: 0;
    }

    /* Header Overhaul */
    .global-status-bar {
        position: sticky;
        top: 0;
        z-index: 100;
        padding: 0 1rem;
        height: 56px;
        /* Standard Mobile Header */
        justify-content: center;
        /* Center Title */
    }

    .status-bar-left {
        width: 100%;
        justify-content: center;
    }

    .status-bar-right {
        display: none;
        /* Hide desktop stats in header */
    }

    .section-title {
        font-size: 1.1rem;
        text-align: center;
    }

    /* Content Area Padding */
    .content-area {
        padding: 1rem;
        /* Reduced padding */
    }

    /* --- Bottom Navigation --- */
    .bottom-nav {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 0.75rem 0.5rem;
        /* Increased padding slightly for safe area */
        z-index: 1000;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    }

    .nav-item {
        color: var(--text-muted);
        text-decoration: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        flex: 1;
    }

    .nav-item .material-icons {
        font-size: 1.5rem;
        transition: color 0.2s;
    }

    .nav-item span {
        font-size: 0.7rem;
        font-weight: 500;
    }

    .nav-item.active {
        color: var(--primary);
    }

    .nav-item:active {
        transform: scale(0.95);
    }

    /* Center Logo in Nav */
    .nav-logo-container {
        position: relative;
        top: -15px;
        /* Pull up to float */
        background: var(--bg-card);
        border-radius: 50%;
        padding: 6px;
        /* Inner padding */
        border: 1px solid var(--border-color);
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
    }

    .nav-logo {
        height: 60px;
        /* Increased by ~20% (was likely ~48-50px effective before) */
        width: auto;
        display: block;
        transition: transform 0.2s;
    }

    .nav-logo:active {
        transform: scale(0.95);
    }

    /* --- Toolbar Adjustments (Downloads Page) --- */
    .toolbar {
        flex-direction: column;
        align-items: stretch !important;
        gap: 1rem;
        height: auto !important;
        padding: 1rem !important;
        overflow: hidden;
        /* Prevent cutoff */
    }

    .toolbar-left,
    .toolbar-right {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
    }

    .toolbar-right {
        justify-content: space-between;
        /* Spread buttons */
    }

    /* Fix Search Bar Cutoff */
    .search-container {
        width: 100%;
        margin: 0 !important;
        max-width: 100% !important;
    }

    .elegant-search-input {
        width: 100% !important;
        box-sizing: border-box;
        /* Ensure padding doesn't overflow */
    }

    /* --- Downloads Table to Card View (Full List) --- */
    #downloads-full-list {
        display: block;
        /* Break table structure */
    }

    #downloads-full-list tr {
        display: flex;
        flex-direction: column;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 1rem;
        padding: 1rem;
        position: relative;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    #downloads-full-list td {
        display: block;
        width: 100% !important;
        max-width: none !important;
        padding: 0.25rem 0;
        border: none;
        text-align: left !important;
    }

    /* Hide Checkbox on Mobile to save space (or position absolute) */
    #downloads-full-list .checkbox-cell {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: auto !important;
        padding: 0;
        z-index: 5;
    }

    /* Name Styles */
    #downloads-full-list .cell-name {
        order: 1;
        margin-bottom: 0.5rem;
        padding-right: 2rem;
        /* Space for checkbox */
    }

    #downloads-full-list .download-name {
        font-size: 1rem !important;
        white-space: normal !important;
        /* Allow wrapping */
        overflow: visible !important;
    }

    /* Status & Progress */
    #downloads-full-list .cell-status {
        Order: 2;
        margin-bottom: 0.25rem;
    }

    #downloads-full-list .cell-progress {
        order: 3;
        margin-bottom: 0.5rem;
        width: 100% !important;
    }

    /* Details Grid */
    #downloads-full-list .cell-size {
        order: 4;
        display: inline-block !important;
        width: auto !important;
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    #downloads-full-list .cell-speed {
        order: 5;
        display: inline-block !important;
        width: auto !important;
        float: right;
        font-size: 0.8rem;
        color: var(--primary);
        font-weight: 700;
    }

    #downloads-full-list .cell-eta {
        order: 6;
        clear: both;
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }

    /* Hide desktop-only columns if needed */
    #downloads-full-list .cell-added,
    #downloads-full-list .cell-category {
        display: none !important;
    }

    /* --- Search Page Fixes --- */
    .filter-section {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 0.5rem;
        -webkit-overflow-scrolling: touch;
        margin-bottom: 1rem;
    }

    .filter-group {
        display: inline-flex;
        /* Keep buttons together */
        margin-right: 1rem;
    }

    /* --- Settings Page Fixes --- */
    .settings-tabs-header {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
        -webkit-overflow-scrolling: touch;
        display: flex;
        gap: 0.5rem;
    }

    .tab-btn {
        flex: 0 0 auto;
        /* Don't shrink */
    }

    /* Account Card Studio Layout Fix */
    .account-cell {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 0.5rem;
    }

    .account-meta {
        margin-left: 0 !important;
    }

    /* Downloads Settings Form Stacking */
    .settings-card .form-group {
        flex-direction: column;
        align-items: flex-start !important;
    }

    .category-paths .category-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }

    .category-label {
        width: 100%;
        margin-bottom: 0.25rem;
    }

    /* Split Concurrent/Speed Row */
    .settings-card .form-row {
        flex-direction: column !important;
        gap: 1rem !important;
    }

    .settings-card .form-row .form-group {
        width: 100% !important;
    }

    /* Theme Icons */
    .theme-selector {
        justify-content: space-between;
        /* Even spacing */
        gap: 0.5rem;
    }

    .theme-option {
        flex: 1;
        padding: 0.5rem !important;
        text-align: center;
    }

    .theme-preview {
        margin: 0 auto 0.5rem auto;
        /* Center icon */
    }

    .download-table thead {
        display: none;
        /* Hide Table Headers */
    }

    .download-table tbody {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .download-table tr {
        display: grid;
        grid-template-areas:
            "checkbox name name name"
            "progress progress progress progress"
            "status speed eta size"
            "category added . .";
        grid-template-columns: 30px 1fr 1fr 1fr;
        gap: 0.5rem;

        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        height: auto !important;
    }

    .download-table td {
        display: block;
        border: none;
        padding: 0 !important;
        height: auto !important;
        text-align: left !important;
    }

    /* Cell Specific Mapping */
    .mui-head-cell.checkbox-cell,
    .download-table td.checkbox-cell {
        grid-area: checkbox;
        width: auto !important;
        max-width: none !important;
        min-width: auto !important;
        align-self: center;
    }

    .cell-name {
        grid-area: name;
        font-weight: 700;
        font-size: 0.95rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        align-self: center;
    }

    /* Adjust file icon size */
    .cell-name .material-icons {
        font-size: 1.1rem;
        vertical-align: text-bottom;
    }

    .cell-progress {
        grid-area: progress;
        width: 100%;
        margin-top: 0.25rem;
        margin-bottom: 0.25rem;
    }

    /* Make progress bar thicker on mobile for visibility */
    .linear-progress {
        height: 6px;
    }

    .cell-status {
        grid-area: status;
    }

    .cell-speed {
        grid-area: speed;
        font-size: 0.8rem;
        color: var(--text-muted);
        justify-self: center;
    }

    .cell-eta {
        grid-area: eta;
        font-size: 0.8rem;
        color: var(--text-muted);
        justify-self: center;
    }

    .cell-size {
        grid-area: size;
        font-size: 0.8rem;
        color: var(--text-muted);
        justify-self: end;
    }

    .cell-category {
        grid-area: category;
        align-self: end;
    }

    .cell-date {
        grid-area: added;
        font-size: 0.7rem;
        color: var(--text-muted);
        align-self: center;
    }

    /* Hide unused cells */
    .download-table tr td:empty {
        display: none;
    }

    /* Toolbar Adjustments */
    .elegant-toolbar {
        flex-direction: column;
        gap: 1rem;
        padding: 0;
        background: transparent;
        box-shadow: none;
        margin-bottom: 1rem;
    }

    .search-wrapper {
        width: 100%;
        max-width: 100%;
        margin: 0;
    }

    .action-group {
        width: 100%;
        justify-content: space-between;
    }

    /* Adjust Status Chips for Mobile */
    .status-chip {
        font-size: 0.65rem;
        padding: 2px 6px;
        height: auto;
    }

    /* Footer Adjustments */
    .downloads-container tfoot,
    .download-table tfoot {
        display: none !important;
        /* Hide footer pagination, maybe implement infinite scroll or simplified pager later?
         For now, keeping it simple. Or remake it flex column.
      */
    }

    /* Show simplified pager outside table for mobile? 
     Actually, let's keep the footer but styled differently if possible. 
     Since tfoot is part of table, and we broke table display, it might be messy.
     Let's hide standard footer and rely on user scrolling or top controls if any. 
  */

    /* Dashboard Grid - Single Column */
    .dashboard-grid {
        grid-template-columns: 1fr;
    }

    /* Override inline styles for the Stats Grid (Account/Queue) */
    .stats-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }

    /* Allow card body to flow naturally */
    .stats-card {
        height: auto !important;
        text-align: left !important;
    }

    /* --- Minified Queue Card View (Mobile) --- */
    .minified-list-header {
        display: none !important;
    }

    .minified-list-grid.minified-item {
        display: grid;
        grid-template-areas:
            "name name"
            "status status"
            "size speed";
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        padding: 1rem;
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .minified-item .name-col {
        grid-area: name;
        font-weight: 700;
        font-size: 0.95rem;
        width: 100%;
        margin-bottom: 0.25rem;
        padding-right: 0 !important;
    }

    .minified-item .status-col {
        grid-area: status;
        width: 100%;
    }

    .minified-item .size-col {
        grid-area: size;
        text-align: left !important;
        font-size: 0.8rem;
    }

    .minified-item .speed-col {
        grid-area: speed;
        text-align: right !important;
        font-size: 0.8rem;
        color: var(--primary);
    }
}
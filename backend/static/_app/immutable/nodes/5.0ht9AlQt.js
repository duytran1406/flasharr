import"../chunks/DsnmJJEf.js";import{i as _t}from"../chunks/8XRdHUAM.js";import{b as pt,o as gt,e as bt,s as k}from"../chunks/CikeeQrg.js";import{p as ft,V as _,k as i,j as e,t as w,a as h,b as mt,e as xt,s as n,d as s,c as D,aa as te,ab as ht,r,ac as xe,a7 as yt,a9 as he,f as ye,L as $e}from"../chunks/BNLZGSLr.js";import{i as U}from"../chunks/DRhJDK-J.js";import{e as z,d as Te,r as we,i as ae,a as $t,s as re,b as Tt,c as wt}from"../chunks/Kudn4uhO.js";import{h as Dt}from"../chunks/DsZk5KCm.js";import{b as De,E as Rt,M as It}from"../chunks/Du42tvOL.js";import{b as Pt}from"../chunks/9m8yitw2.js";import"../chunks/7UhqhOqn.js";var At=D("<option> </option>"),qt=D('<div class="initial-loading svelte-b0xv90"><div class="spinner svelte-b0xv90"></div> <p class="svelte-b0xv90">Loading content...</p></div>'),St=D('<div class="error-container svelte-b0xv90"><!></div>'),Et=D('<div class="loading-indicator svelte-b0xv90"><div class="spinner svelte-b0xv90"></div> <p>Loading more...</p></div>'),Mt=D("<option> </option>"),kt=D("<option> </option>"),Ft=D("<button> </button>"),Yt=D('<div class="filter-sidebar svelte-b0xv90"><div class="filter-header svelte-b0xv90"><h3 class="svelte-b0xv90">Intelligence Filters</h3> <button class="clear-btn svelte-b0xv90">Reset</button></div> <div class="filter-section svelte-b0xv90"><label for="from-year" class="svelte-b0xv90">Temporal Range (Year)</label> <div class="year-inputs svelte-b0xv90"><div class="select-wrapper svelte-b0xv90"><select id="from-year" class="svelte-b0xv90"><option>Starting Year</option><!></select></div> <div class="select-wrapper svelte-b0xv90"><select id="to-year" aria-label="To Year" class="svelte-b0xv90"><option>Ending Year</option><!></select></div></div></div> <div class="filter-section svelte-b0xv90"><div role="group" aria-label="Genres"><span class="filter-label-text svelte-b0xv90">Genres</span> <div class="genre-tags svelte-b0xv90"></div></div></div> <div class="filter-section svelte-b0xv90"><span class="filter-label-text svelte-b0xv90"> </span> <div class="rating-slider-v2 svelte-b0xv90"><div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="min-rating" type="range" min="0" max="10" step="0.5" class="svelte-b0xv90"/></div> <div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="max-rating" type="range" min="0" max="10" step="0.5" aria-label="Max Rating" class="svelte-b0xv90"/></div></div></div></div>'),Gt=D('<div class="discover-page svelte-b0xv90"><div class="control-bar glass-panel svelte-b0xv90"><div class="search-section svelte-b0xv90"><span class="material-icons search-icon svelte-b0xv90">search</span> <input type="text" class="search-input svelte-b0xv90"/></div> <div class="controls-right svelte-b0xv90"><div class="media-toggle svelte-b0xv90"><button>MOVIES</button> <button>TV</button></div> <div class="select-wrapper svelte-b0xv90"><select class="sort-select svelte-b0xv90"></select> <span class="material-icons select-chevron">expand_more</span></div> <button><span class="material-icons">tune</span></button></div></div> <div class="content-wrapper svelte-b0xv90"><div class="discover-scroll-container svelte-b0xv90"><div class="discover-grid svelte-b0xv90"><!></div> <!></div> <!></div></div>');function zt(Oe,je){ft(je,!1);const Re=20,se=1e3;let R=_("movie"),P=_("popularity.desc"),F=_(""),J=_(!1),Y=_(""),G=_(""),$=_([]),A=_(0),q=_(10),Ie=_([]),S=_(!1),K=_(null),le=1,B=!0,N=_();const p=_(Array.from({length:se},(t,a)=>({slotId:a,visible:!1,data:null})));let C=0,I=null,Pe=0;const Ze=[{value:"popular_today",label:"Popular Today"},{value:"popularity.desc",label:"Popularity Descending"},{value:"popularity.asc",label:"Popularity Ascending"},{value:"release_date.desc",label:"Release Date Descending"},{value:"release_date.asc",label:"Release Date Ascending"},{value:"vote_average.desc",label:"TMDB Rating Descending"},{value:"vote_average.asc",label:"TMDB Rating Ascending"},{value:"title.asc",label:"Title A-Z"},{value:"title.desc",label:"Title Z-A"}];function Qe(t){for(const a of t)if(C<se)te(p,e(p)[C].data=a),te(p,e(p)[C].visible=!0),C++;else{console.warn("[Discover] Pool is full, cannot add more items");break}console.log(`[Discover] Pool updated: ${C} visible slots`)}function Ue(){for(let t=0;t<se;t++)te(p,e(p)[t].visible=!1),te(p,e(p)[t].data=null);C=0,console.log("[Discover] Pool cleared")}async function Ae(){try{const t=e(R)==="movie"?"/api/tmdb/genres/movie":"/api/tmdb/genres/tv",o=await(await fetch(t)).json();i(Ie,o.genres||[])}catch(t){console.error("Failed to fetch genres:",t)}}async function f(t=!1){if(!t&&(e(S)||!B)){console.log(`[Discover] Skipping fetch - loading: ${e(S)}, hasMore: ${B}`);return}I&&(console.log("[Discover] Aborting previous request"),I.abort()),I=new AbortController;const a=++Pe,o=setTimeout(()=>{console.error("[Discover] Request timeout - aborting"),I?.abort()},1e4),u=e(R),m=e(F),g=e(P),v=t?1:le;console.log(`[Discover] Starting fetch #${a} - Page ${v}, Type: ${u}`),i(S,!0),t&&(le=1,Ue(),B=!0);try{let l="";g==="popular_today"?l=`/api/discovery/popular-today?type=${u}&page=${v}&limit=${Re}`:m.trim()?l=`/api/tmdb/search?q=${encodeURIComponent(m)}&media_type=${u}&page=${v}`:(l=`/api/tmdb/discover/${u}?page=${v}&sort_by=${g}`,e(Y)&&(l+=`&primary_release_date.gte=${e(Y)}-01-01`),e(G)&&(l+=`&primary_release_date.lte=${e(G)}-12-31`),e($).length>0&&(l+=`&with_genres=${e($).join(",")}`),e(A)>0&&(l+=`&vote_average.gte=${e(A)}`),e(q)<10&&(l+=`&vote_average.lte=${e(q)}`)),console.log(`[Discover] Fetching: ${l}`);const x=await fetch(l,{signal:I.signal});if(!x.ok)throw new Error(`HTTP ${x.status}: ${x.statusText}`);const d=await x.json();if(clearTimeout(o),a!==Pe){console.warn(`[Discover] Request #${a} is stale`);return}if(u!==e(R)||m!==e(F)||g!==e(P)){console.warn("[Discover] Discarding stale results");return}const T=d.results||[];if(!Array.isArray(T))throw new Error("Invalid API response");Qe(T),le=v+1,B=T.length===Re,i(K,null)}catch(l){l instanceof Error&&l.name==="AbortError"?console.warn(`[Discover] Request #${a} was aborted`):(console.error(`[Discover] Request #${a} failed:`,l),i(K,l instanceof Error?l.message:"Failed to load content"),B=!1)}finally{clearTimeout(o),i(S,!1),I=null,console.log(`[Discover] Request #${a} complete. Visible slots: ${e(p).filter(l=>l.visible).length}`)}}let V;function ze(){e(N)&&(V&&clearTimeout(V),V=window.setTimeout(()=>{const{scrollTop:t,scrollHeight:a,clientHeight:o}=e(N);a-t-o<500&&!e(S)&&B&&(console.log("[Discover] Triggering fetchDiscoverData from scroll"),f())},100))}function Je(t){e($).includes(t)?i($,e($).filter(a=>a!==t)):i($,[...e($),t]),f(!0)}function Ke(){i(Y,""),i(G,""),i($,[]),i(A,0),i(q,10),f(!0)}function qe(t){i(R,t),i($,[]),Ae(),f(!0)}function Ne(t){i(P,t),f(!0)}let Se;function We(){clearTimeout(Se),Se=window.setTimeout(()=>{f(!0)},500)}function Xe(t){const a=t.vote_average||0,o="release_date"in t?parseInt(t.release_date?.substring(0,4)||"0"):parseInt(t.first_air_date?.substring(0,4)||"0");if(a>=8.5)return{text:"HIGHLY RATED",color:"gold"};const u=new Date().getFullYear();return o&&o<=u-30?{text:"CLASSIC",color:"teal"}:null}function et(t){return"title"in t?t.title:t.name}const tt=new Date().getFullYear(),Ee=Array.from({length:100},(t,a)=>tt-a);gt(()=>(console.log("[Discover] ðŸš€ Version 2.0.3 - 1000-Slot Pool Build"),Ae(),f(!0),()=>{V&&clearTimeout(V),I&&I.abort()})),_t();var ie=Gt();Dt("b0xv90",t=>{xt(()=>{ht.title="Discover - Flasharr"})});var oe=s(ie),ne=s(oe),H=n(s(ne),2);we(H),H.__click=()=>i(F,e(F)),H.__input=We,r(ne);var Me=n(ne,2),ve=s(Me),ce=s(ve);let ke;ce.__click=()=>qe("movie");var Fe=n(ce,2);let Ye;Fe.__click=()=>qe("tv"),r(ve);var de=n(ve,2),W=s(de);w(()=>{e(P),xe(()=>{})}),W.__change=()=>Ne(e(P)),z(W,5,()=>Ze,ae,(t,a)=>{var o=At(),u=s(o,!0);r(o);var m={};w(()=>{k(u,e(a).label),m!==(m=e(a).value)&&(o.value=(o.__value=e(a).value)??"")}),h(t,o)}),r(W),yt(2),r(de);var Ge=n(de,2);let Be;Ge.__click=()=>i(J,!e(J)),r(Me),r(oe);var Ce=n(oe,2),O=s(Ce),ue=s(O),at=s(ue);{var rt=t=>{var a=qt();h(t,a)},st=t=>{var a=he(),o=ye(a);{var u=g=>{var v=St(),l=s(v);Rt(l,{title:"Failed to load content",get message(){return e(K)},showRetry:!0,onRetry:()=>f(!0)}),r(v),h(g,v)},m=g=>{var v=he(),l=ye(v);z(l,1,()=>e(p),x=>x.slotId,(x,d)=>{var T=he(),E=ye(T);{var j=Z=>{{let Q=$e(()=>et(e(d).data)),X=$e(()=>"release_date"in e(d).data?e(d).data.release_date:e(d).data.first_air_date),ee=$e(()=>Xe(e(d).data)||void 0);It(Z,{get id(){return e(d).data.id},get title(){return e(Q)},get posterPath(){return e(d).data.poster_path},get voteAverage(){return e(d).data.vote_average},get releaseDate(){return e(X)},get overview(){return e(d).data.overview},get mediaType(){return e(R)},get badge(){return e(ee)}})}};U(E,Z=>{e(d).visible&&e(d).data&&Z(j)})}h(x,T)}),h(g,v)};U(o,g=>{e(K)&&e(p).filter(v=>v.visible).length===0?g(u):g(m,!1)},!0)}h(t,a)};U(at,t=>{e(S)&&e(p).filter(a=>a.visible).length===0?t(rt):t(st,!1)})}r(ue);var lt=n(ue,2);{var it=t=>{var a=Et();h(t,a)};U(lt,t=>{e(S)&&e(p).filter(a=>a.visible).length>0&&t(it)})}r(O),Pt(O,t=>i(N,t),()=>e(N));var ot=n(O,2);{var nt=t=>{var a=Yt(),o=s(a),u=n(s(o),2);u.__click=Ke,r(o);var m=n(o,2),g=n(s(m),2),v=s(g),l=s(v);w(()=>{e(Y),xe(()=>{})}),l.__change=()=>f(!0);var x=s(l);x.value=x.__value="";var d=n(x);z(d,1,()=>Ee,ae,(b,y)=>{var c=Mt(),L=s(c,!0);r(c);var M={};w(()=>{k(L,e(y)),M!==(M=e(y))&&(c.value=(c.__value=e(y))??"")}),h(b,c)}),r(l),r(v);var T=n(v,2),E=s(T);w(()=>{e(G),xe(()=>{})}),E.__change=()=>f(!0);var j=s(E);j.value=j.__value="";var Z=n(j);z(Z,1,()=>Ee,ae,(b,y)=>{var c=kt(),L=s(c,!0);r(c);var M={};w(()=>{k(L,e(y)),M!==(M=e(y))&&(c.value=(c.__value=e(y))??"")}),h(b,c)}),r(E),r(T),r(g),r(m);var Q=n(m,2),X=s(Q),ee=n(s(X),2);z(ee,5,()=>e(Ie),ae,(b,y)=>{var c=Ft();let L;c.__click=()=>Je(e(y).id);var M=s(c,!0);r(c),w(ut=>{L=re(c,1,"genre-tag svelte-b0xv90",null,L,ut),k(M,e(y).name)},[()=>({active:e($).includes(e(y).id)})]),h(b,c)}),r(ee),r(X),r(Q);var Le=n(Q,2),_e=s(Le),vt=s(_e);r(_e);var Ve=n(_e,2),pe=s(Ve),ge=s(pe),ct=s(ge);r(ge);var be=n(ge,2);we(be),be.__change=()=>f(!0),r(pe);var He=n(pe,2),fe=s(He),dt=s(fe);r(fe);var me=n(fe,2);we(me),me.__change=()=>f(!0),r(He),r(Ve),r(Le),r(a),w(()=>{k(vt,`Intelligence Grade (${e(A)??""} - ${e(q)??""})`),k(ct,`Min: ${e(A)??""}`),k(dt,`Max: ${e(q)??""}`)}),De(l,()=>e(Y),b=>i(Y,b)),De(E,()=>e(G),b=>i(G,b)),Te(be,()=>e(A),b=>i(A,b)),Te(me,()=>e(q),b=>i(q,b)),Tt(3,a,()=>wt,()=>({x:300,duration:300})),h(t,a)};U(ot,t=>{e(J)&&t(nt)})}r(Ce),r(ie),w(()=>{$t(H,"placeholder",`Search ${e(R)==="movie"?"Movies":"TV Series"}...`),ke=re(ce,1,"toggle-btn svelte-b0xv90",null,ke,{active:e(R)==="movie"}),Ye=re(Fe,1,"toggle-btn svelte-b0xv90",null,Ye,{active:e(R)==="tv"}),Be=re(Ge,1,"filter-toggle-btn svelte-b0xv90",null,Be,{active:e(J)})}),Te(H,()=>e(F),t=>i(F,t)),De(W,()=>e(P),t=>i(P,t)),bt("scroll",O,ze),h(Oe,ie),mt()}pt(["click","input","change"]);export{zt as component};

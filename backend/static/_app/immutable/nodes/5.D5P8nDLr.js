import"../chunks/DsnmJJEf.js";import{i as lt}from"../chunks/DPambpWf.js";import{b as it,o as vt,e as nt,s as F}from"../chunks/CpQGpjHh.js";import{a9 as N,f as W,t as k,a as p,c as q,p as ot,k as l,j as e,b as ct,T as _,e as dt,s as n,d as r,ag as _t,r as a,ai as ge,a7 as ut,L as be}from"../chunks/DkP3IR00.js";import{i as K}from"../chunks/DRm4gdwb.js";import{e as G,i as P,s as O,d as fe,r as me,a as pt,b as gt,c as bt}from"../chunks/Bx19YLT4.js";import{h as ft}from"../chunks/B5XdgsWK.js";import{j as xe,E as mt,M as xt}from"../chunks/D8kBj3AC.js";import{b as ht}from"../chunks/CRENxaln.js";import"../chunks/Dqzw7G8x.js";import{s as yt}from"../chunks/ysiDY0Qf.js";import{p as Ee}from"../chunks/DPsHQfHC.js";var wt=q('<div><div class="skeleton-image svelte-e6eaq7"></div> <div class="skeleton-content svelte-e6eaq7"><div class="skeleton-title svelte-e6eaq7"></div> <div class="skeleton-meta svelte-e6eaq7"><div class="skeleton-rating svelte-e6eaq7"></div> <div class="skeleton-year svelte-e6eaq7"></div></div></div></div>');function $t(X,V){let m=Ee(V,"mode",3,"poster"),D=Ee(V,"count",3,1);var $=N(),I=W($);G(I,17,()=>Array(D()),P,(R,S,g)=>{var x=wt();yt(x,`animation-delay: ${g*.1}s`),k(()=>O(x,1,`skeleton-card mode-${m()??""}`,"svelte-e6eaq7")),p(R,x)}),p(X,$)}var Tt=q("<option> </option>"),kt=q('<div class="error-container svelte-b0xv90"><!></div>'),Dt=q('<div class="loading-indicator svelte-b0xv90"><div class="spinner svelte-b0xv90"></div> <p>Loading more...</p></div>'),qt=q("<option> </option>"),Rt=q("<option> </option>"),Mt=q("<button> </button>"),St=q('<div class="filter-sidebar svelte-b0xv90"><div class="filter-header svelte-b0xv90"><h3 class="svelte-b0xv90">Intelligence Filters</h3> <button class="clear-btn svelte-b0xv90">Reset</button></div> <div class="filter-section svelte-b0xv90"><label for="from-year" class="svelte-b0xv90">Temporal Range (Year)</label> <div class="year-inputs svelte-b0xv90"><div class="select-wrapper svelte-b0xv90"><select id="from-year" class="svelte-b0xv90"><option>Starting Year</option><!></select></div> <div class="select-wrapper svelte-b0xv90"><select id="to-year" aria-label="To Year" class="svelte-b0xv90"><option>Ending Year</option><!></select></div></div></div> <div class="filter-section svelte-b0xv90"><div role="group" aria-label="Genres"><span class="filter-label-text svelte-b0xv90">Genres</span> <div class="genre-tags svelte-b0xv90"></div></div></div> <div class="filter-section svelte-b0xv90"><span class="filter-label-text svelte-b0xv90"> </span> <div class="rating-slider-v2 svelte-b0xv90"><div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="min-rating" type="range" min="0" max="10" step="0.5" class="svelte-b0xv90"/></div> <div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="max-rating" type="range" min="0" max="10" step="0.5" aria-label="Max Rating" class="svelte-b0xv90"/></div></div></div></div>'),At=q('<div class="discover-page svelte-b0xv90"><div class="control-bar glass-panel svelte-b0xv90"><div class="search-section svelte-b0xv90"><span class="material-icons search-icon svelte-b0xv90">search</span> <input type="text" class="search-input svelte-b0xv90"/></div> <div class="controls-right svelte-b0xv90"><div class="media-toggle svelte-b0xv90"><button>MOVIES</button> <button>TV</button></div> <div class="select-wrapper svelte-b0xv90"><select class="sort-select svelte-b0xv90"></select> <span class="material-icons select-chevron">expand_more</span></div> <button><span class="material-icons">tune</span></button></div></div> <div class="content-wrapper svelte-b0xv90"><div class="discover-scroll-container svelte-b0xv90"><div class="discover-grid svelte-b0xv90"><!></div> <!></div> <!></div></div>');function Vt(X,V){ot(V,!1);let m=_("movie"),D=_("popularity.desc"),$=_(""),I=_(!1),R=_(""),S=_(""),g=_([]),x=_(0),A=_(10),M=_([]),he=_([]),C=_(!1),Q=_(null),ee=1,Z=!0,U=_();const je=[{value:"popular_today",label:"Popular Today"},{value:"popularity.desc",label:"Popularity Descending"},{value:"popularity.asc",label:"Popularity Ascending"},{value:"release_date.desc",label:"Release Date Descending"},{value:"release_date.asc",label:"Release Date Ascending"},{value:"vote_average.desc",label:"TMDB Rating Descending"},{value:"vote_average.asc",label:"TMDB Rating Ascending"},{value:"title.asc",label:"Title A-Z"},{value:"title.desc",label:"Title Z-A"}];async function ye(){try{const t=e(m)==="movie"?"/api/tmdb/genres/movie":"/api/tmdb/genres/tv",i=await(await fetch(t)).json();l(he,i.genres||[])}catch(t){console.error("Failed to fetch genres:",t)}}async function b(t=!1){if(!t&&(e(C)||!Z))return;const s=e(m),i=e($),c=e(D),d=t?1:ee;l(C,!0),t&&(ee=1,l(M,[]),Z=!0);try{let v="";c==="popular_today"?v=`/api/discovery/popular-today?type=${s}&page=${d}&limit=20`:i.trim()?v=`/api/tmdb/search?q=${encodeURIComponent(i)}&media_type=${s}&page=${d}`:(v=`/api/tmdb/discover/${s}?page=${d}&sort_by=${c}`,e(R)&&(v+=`&primary_release_date.gte=${e(R)}-01-01`),e(S)&&(v+=`&primary_release_date.lte=${e(S)}-12-31`),e(g).length>0&&(v+=`&with_genres=${e(g).join(",")}`),e(x)>0&&(v+=`&vote_average.gte=${e(x)}`),e(A)<10&&(v+=`&vote_average.lte=${e(A)}`));const T=await(await fetch(v)).json();if(s!==e(m)||i!==e($)||c!==e(D)){console.warn(`[Discover] Discarding stale results for ${s}`);return}const y=T.results||[];t?l(M,y):l(M,[...e(M),...y]),Z=y.length===20,ee=d+1,l(Q,null)}catch(v){console.error("Failed to fetch discover data:",v),l(Q,v instanceof Error?v.message:"Failed to load content")}finally{s===e(m)&&i===e($)&&l(C,!1)}}function Pe(){if(!e(U))return;const{scrollTop:t,scrollHeight:s,clientHeight:i}=e(U);s-t-i<500&&!e(C)&&Z&&b()}function Be(t){e(g).includes(t)?l(g,e(g).filter(s=>s!==t)):l(g,[...e(g),t]),b(!0)}function He(){l(R,""),l(S,""),l(g,[]),l(x,0),l(A,10),b(!0)}function we(t){l(m,t),l(g,[]),ye(),b(!0)}function Le(t){l(D,t),b(!0)}let $e;function Oe(){clearTimeout($e),$e=window.setTimeout(()=>{b(!0)},500)}function Ve(t){const s=t.vote_average||0,i="release_date"in t?parseInt(t.release_date?.substring(0,4)||"0"):parseInt(t.first_air_date?.substring(0,4)||"0");if(s>=8.5)return{text:"HIGHLY RATED",color:"gold"};const c=new Date().getFullYear();return i&&i<=c-30?{text:"CLASSIC",color:"teal"}:null}function Qe(t){return"title"in t?t.title:t.name}const Ze=new Date().getFullYear(),Te=Array.from({length:100},(t,s)=>Ze-s);vt(()=>{ye(),b(!0)}),lt();var te=At();ft("b0xv90",t=>{dt(()=>{_t.title="Discover - Flasharr"})});var ae=r(te),se=r(ae),B=n(r(se),2);me(B),B.__click=()=>l($,e($)),B.__input=Oe,a(se);var ke=n(se,2),re=r(ke),le=r(re);let De;le.__click=()=>we("movie");var qe=n(le,2);let Re;qe.__click=()=>we("tv"),a(re);var ie=n(re,2),z=r(ie);k(()=>{e(D),ge(()=>{})}),z.__change=()=>Le(e(D)),G(z,5,()=>je,P,(t,s)=>{var i=Tt(),c=r(i,!0);a(i);var d={};k(()=>{F(c,e(s).label),d!==(d=e(s).value)&&(i.value=(i.__value=e(s).value)??"")}),p(t,i)}),a(z),ut(2),a(ie);var Me=n(ie,2);let Se;Me.__click=()=>l(I,!e(I)),a(ke),a(ae);var Ae=n(ae,2),H=r(Ae),ve=r(H),Ue=r(ve);{var ze=t=>{var s=N(),i=W(s);G(i,0,()=>Array(12),P,(c,d)=>{$t(c,{mode:"poster"})}),p(t,s)},Je=t=>{var s=N(),i=W(s);{var c=v=>{var h=kt(),T=r(h);mt(T,{title:"Failed to load content",get message(){return e(Q)},showRetry:!0,onRetry:()=>b(!0)}),a(h),p(v,h)},d=v=>{var h=N(),T=W(h);G(T,1,()=>e(M),y=>y.id,(y,f)=>{{let J=be(()=>Qe(e(f))),E=be(()=>"release_date"in e(f)?e(f).release_date:e(f).first_air_date),L=be(()=>Ve(e(f))||void 0);xt(y,{get id(){return e(f).id},get title(){return e(J)},get posterPath(){return e(f).poster_path},get voteAverage(){return e(f).vote_average},get releaseDate(){return e(E)},get overview(){return e(f).overview},get mediaType(){return e(m)},get badge(){return e(L)}})}}),p(v,h)};K(i,v=>{e(Q)&&e(M).length===0?v(c):v(d,!1)},!0)}p(t,s)};K(Ue,t=>{e(C)&&e(M).length===0?t(ze):t(Je,!1)})}a(ve);var Ke=n(ve,2);{var Ne=t=>{var s=Dt();p(t,s)};K(Ke,t=>{e(C)&&e(M).length>0&&t(Ne)})}a(H),ht(H,t=>l(U,t),()=>e(U));var We=n(H,2);{var Xe=t=>{var s=St(),i=r(s),c=n(r(i),2);c.__click=He,a(i);var d=n(i,2),v=n(r(d),2),h=r(v),T=r(h);k(()=>{e(R),ge(()=>{})}),T.__change=()=>b(!0);var y=r(T);y.value=y.__value="";var f=n(y);G(f,1,()=>Te,P,(u,w)=>{var o=qt(),j=r(o,!0);a(o);var Y={};k(()=>{F(j,e(w)),Y!==(Y=e(w))&&(o.value=(o.__value=e(w))??"")}),p(u,o)}),a(T),a(h);var J=n(h,2),E=r(J);k(()=>{e(S),ge(()=>{})}),E.__change=()=>b(!0);var L=r(E);L.value=L.__value="";var et=n(L);G(et,1,()=>Te,P,(u,w)=>{var o=Rt(),j=r(o,!0);a(o);var Y={};k(()=>{F(j,e(w)),Y!==(Y=e(w))&&(o.value=(o.__value=e(w))??"")}),p(u,o)}),a(E),a(J),a(v),a(d);var ne=n(d,2),Ye=r(ne),Fe=n(r(Ye),2);G(Fe,5,()=>e(he),P,(u,w)=>{var o=Mt();let j;o.__click=()=>Be(e(w).id);var Y=r(o,!0);a(o),k(rt=>{j=O(o,1,"genre-tag svelte-b0xv90",null,j,rt),F(Y,e(w).name)},[()=>({active:e(g).includes(e(w).id)})]),p(u,o)}),a(Fe),a(Ye),a(ne);var Ge=n(ne,2),oe=r(Ge),tt=r(oe);a(oe);var Ie=n(oe,2),ce=r(Ie),de=r(ce),at=r(de);a(de);var _e=n(de,2);me(_e),_e.__change=()=>b(!0),a(ce);var Ce=n(ce,2),ue=r(Ce),st=r(ue);a(ue);var pe=n(ue,2);me(pe),pe.__change=()=>b(!0),a(Ce),a(Ie),a(Ge),a(s),k(()=>{F(tt,`Intelligence Grade (${e(x)??""} - ${e(A)??""})`),F(at,`Min: ${e(x)??""}`),F(st,`Max: ${e(A)??""}`)}),xe(T,()=>e(R),u=>l(R,u)),xe(E,()=>e(S),u=>l(S,u)),fe(_e,()=>e(x),u=>l(x,u)),fe(pe,()=>e(A),u=>l(A,u)),gt(3,s,()=>bt,()=>({x:300,duration:300})),p(t,s)};K(We,t=>{e(I)&&t(Xe)})}a(Ae),a(te),k(()=>{pt(B,"placeholder",`Search ${e(m)==="movie"?"Movies":"TV Series"}...`),De=O(le,1,"toggle-btn svelte-b0xv90",null,De,{active:e(m)==="movie"}),Re=O(qe,1,"toggle-btn svelte-b0xv90",null,Re,{active:e(m)==="tv"}),Se=O(Me,1,"filter-toggle-btn svelte-b0xv90",null,Se,{active:e(I)})}),fe(B,()=>e($),t=>l($,t)),xe(z,()=>e(D),t=>l(D,t)),nt("scroll",H,Pe),p(X,te),ct()}it(["click","input","change"]);export{Vt as component};

import{d as Ne,e as We,a as D,f as Y,s as M}from"../chunks/sPtpOMd4.js";import{i as et}from"../chunks/CMgJJb9x.js";import{p as tt,Y as at,x as l,v as e,t as x,a as st,Q as u,e as rt,s as v,c as r,$ as lt,r as s,Z as ve,X as it,I as ne}from"../chunks/rK_yDtst.js";import{i as ke}from"../chunks/CjsBHn32.js";import{e as C,b as oe,r as ce,i as Q,a as vt,s as V}from"../chunks/CL9ZHmPK.js";import{b as de,M as nt,t as ot,a as ct}from"../chunks/COjJVmrT.js";import{h as dt}from"../chunks/4-53K8X0.js";import{b as ut}from"../chunks/DlyN0Jrn.js";import"../chunks/DgXHKG4T.js";var _t=Y("<option> </option>"),pt=Y('<div class="loading-indicator svelte-b0xv90"><div class="spinner svelte-b0xv90"></div> <p>Analyzing library...</p></div>'),bt=Y("<option> </option>"),gt=Y("<option> </option>"),ft=Y("<button> </button>"),xt=Y('<div class="filter-sidebar svelte-b0xv90"><div class="filter-header svelte-b0xv90"><h3 class="svelte-b0xv90">Intelligence Filters</h3> <button class="clear-btn svelte-b0xv90">Reset</button></div> <div class="filter-section svelte-b0xv90"><label for="from-year" class="svelte-b0xv90">Temporal Range (Year)</label> <div class="year-inputs svelte-b0xv90"><div class="select-wrapper svelte-b0xv90"><select id="from-year" class="svelte-b0xv90"><option>Starting Year</option><!></select></div> <div class="select-wrapper svelte-b0xv90"><select id="to-year" aria-label="To Year" class="svelte-b0xv90"><option>Ending Year</option><!></select></div></div></div> <div class="filter-section svelte-b0xv90"><div role="group" aria-label="Genres"><span class="filter-label-text svelte-b0xv90">Genres</span> <div class="genre-tags svelte-b0xv90"></div></div></div> <div class="filter-section svelte-b0xv90"><span class="filter-label-text svelte-b0xv90"> </span> <div class="rating-slider-v2 svelte-b0xv90"><div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="min-rating" type="range" min="0" max="10" step="0.5" class="svelte-b0xv90"/></div> <div class="rating-row svelte-b0xv90"><span class="svelte-b0xv90"> </span> <input id="max-rating" type="range" min="0" max="10" step="0.5" aria-label="Max Rating" class="svelte-b0xv90"/></div></div></div></div>'),ht=Y('<div class="discover-page svelte-b0xv90"><div class="control-bar glass-panel svelte-b0xv90"><div class="search-section svelte-b0xv90"><span class="material-icons search-icon svelte-b0xv90">search</span> <input type="text" class="search-input svelte-b0xv90"/></div> <div class="controls-right svelte-b0xv90"><div class="media-toggle svelte-b0xv90"><button>MOVIES</button> <button>TV</button></div> <div class="select-wrapper svelte-b0xv90"><select class="sort-select svelte-b0xv90"></select> <span class="material-icons select-chevron">expand_more</span></div> <button><span class="material-icons">tune</span></button></div></div> <div class="content-wrapper svelte-b0xv90"><div class="discover-scroll-container svelte-b0xv90"><div class="discover-grid svelte-b0xv90"></div> <!></div> <!></div></div>');function At(qe,Fe){tt(Fe,!1);let f=u("movie"),h=u("popularity.desc"),m=u(""),P=u(!1),R=u(""),A=u(""),g=u([]),y=u(0),$=u(10),q=u([]),ue=u([]),F=u(!1),Z=1,B=!0,H=u();const Ie=[{value:"popular_today",label:"Popular Today"},{value:"popularity.desc",label:"Popularity Descending"},{value:"popularity.asc",label:"Popularity Ascending"},{value:"release_date.desc",label:"Release Date Descending"},{value:"release_date.asc",label:"Release Date Ascending"},{value:"vote_average.desc",label:"TMDB Rating Descending"},{value:"vote_average.asc",label:"TMDB Rating Ascending"},{value:"title.asc",label:"Title A-Z"},{value:"title.desc",label:"Title Z-A"}];async function _e(){try{const t=e(f)==="movie"?"/api/tmdb/genres/movie":"/api/tmdb/genres/tv",i=await(await fetch(t)).json();l(ue,i.genres||[])}catch(t){console.error("Failed to fetch genres:",t)}}async function p(t=!1){if(!t&&(e(F)||!B))return;const a=e(f),i=e(m),_=e(h),c=t?1:Z;l(F,!0),t&&(Z=1,l(q,[]),B=!0);try{let o="";_==="popular_today"?o=`/api/discovery/popular-today?type=${a}&page=${c}&limit=20`:i.trim()?o=`/api/tmdb/search?q=${encodeURIComponent(i)}&media_type=${a}&page=${c}`:(o=`/api/tmdb/discover/${a}?page=${c}&sort_by=${_}`,e(R)&&(o+=`&primary_release_date.gte=${e(R)}-01-01`),e(A)&&(o+=`&primary_release_date.lte=${e(A)}-12-31`),e(g).length>0&&(o+=`&with_genres=${e(g).join(",")}`),e(y)>0&&(o+=`&vote_average.gte=${e(y)}`),e($)<10&&(o+=`&vote_average.lte=${e($)}`));const S=await(await fetch(o)).json();if(a!==e(f)||i!==e(m)||_!==e(h)){console.warn(`[Discover] Discarding stale results for ${a}`);return}const w=S.results||[];t?l(q,w):l(q,[...e(q),...w]),B=w.length===20,Z=c+1}catch(o){console.error("Failed to fetch discover data:",o)}finally{a===e(f)&&i===e(m)&&l(F,!1)}}function Ge(){if(!e(H))return;const{scrollTop:t,scrollHeight:a,clientHeight:i}=e(H);a-t-i<500&&!e(F)&&B&&p()}function Ce(t){e(g).includes(t)?l(g,e(g).filter(a=>a!==t)):l(g,[...e(g),t]),p(!0)}function Pe(){l(R,""),l(A,""),l(g,[]),l(y,0),l($,10),p(!0)}function pe(t){l(f,t),l(g,[]),_e(),p(!0)}function Be(t){l(h,t),p(!0)}let be;function He(){clearTimeout(be),be=window.setTimeout(()=>{p(!0)},500)}function je(t){const a=t.vote_average||0,i="release_date"in t?parseInt(t.release_date?.substring(0,4)||"0"):parseInt(t.first_air_date?.substring(0,4)||"0");if(a>=8.5)return{text:"HIGHLY RATED",color:"gold"};const _=new Date().getFullYear();return i&&i<=_-30?{text:"CLASSIC",color:"teal"}:null}function Ee(t){return"title"in t?t.title:t.name}const Oe=new Date().getFullYear(),ge=Array.from({length:100},(t,a)=>Oe-a);at(()=>{_e(),p(!0)}),et();var L=ht();dt("b0xv90",t=>{rt(()=>{lt.title="Discover - Flasharr"})});var z=r(L),U=r(z),I=v(r(U),2);ce(I),I.__click=()=>l(m,e(m)),I.__input=He,s(U);var fe=v(U,2),X=r(fe),J=r(X);let xe;J.__click=()=>pe("movie");var he=v(J,2);let me;he.__click=()=>pe("tv"),s(X);var K=v(X,2),j=r(K);x(()=>{e(h),ve(()=>{})}),j.__change=()=>Be(e(h)),C(j,5,()=>Ie,Q,(t,a)=>{var i=_t(),_=r(i,!0);s(i);var c={};x(()=>{M(_,e(a).label),c!==(c=e(a).value)&&(i.value=(i.__value=e(a).value)??"")}),D(t,i)}),s(j),it(2),s(K);var ye=v(K,2);let $e;ye.__click=()=>l(P,!e(P)),s(fe),s(z);var we=v(z,2),G=r(we),N=r(G);C(N,5,()=>e(q),t=>t.id,(t,a)=>{{let i=ne(()=>Ee(e(a))),_=ne(()=>"release_date"in e(a)?e(a).release_date:e(a).first_air_date),c=ne(()=>je(e(a))||void 0);nt(t,{get id(){return e(a).id},get title(){return e(i)},get posterPath(){return e(a).poster_path},get voteAverage(){return e(a).vote_average},get releaseDate(){return e(_)},get overview(){return e(a).overview},get mediaType(){return e(f)},get badge(){return e(c)}})}}),s(N);var Qe=v(N,2);{var Ve=t=>{var a=pt();D(t,a)};ke(Qe,t=>{e(F)&&t(Ve)})}s(G),ut(G,t=>l(H,t),()=>e(H));var Ze=v(G,2);{var Le=t=>{var a=xt(),i=r(a),_=v(r(i),2);_.__click=Pe,s(i);var c=v(i,2),o=v(r(c),2),E=r(o),S=r(E);x(()=>{e(R),ve(()=>{})}),S.__change=()=>p(!0);var w=r(S);w.value=w.__value="";var Te=v(w);C(Te,1,()=>ge,Q,(d,b)=>{var n=bt(),k=r(n,!0);s(n);var T={};x(()=>{M(k,e(b)),T!==(T=e(b))&&(n.value=(n.__value=e(b))??"")}),D(d,n)}),s(S),s(E);var De=v(E,2),O=r(De);x(()=>{e(A),ve(()=>{})}),O.__change=()=>p(!0);var W=r(O);W.value=W.__value="";var ze=v(W);C(ze,1,()=>ge,Q,(d,b)=>{var n=gt(),k=r(n,!0);s(n);var T={};x(()=>{M(k,e(b)),T!==(T=e(b))&&(n.value=(n.__value=e(b))??"")}),D(d,n)}),s(O),s(De),s(o),s(c);var ee=v(c,2),Me=r(ee),Ye=v(r(Me),2);C(Ye,5,()=>e(ue),Q,(d,b)=>{var n=ft();let k;n.__click=()=>Ce(e(b).id);var T=r(n,!0);s(n),x(Ke=>{k=V(n,1,"genre-tag svelte-b0xv90",null,k,Ke),M(T,e(b).name)},[()=>({active:e(g).includes(e(b).id)})]),D(d,n)}),s(Ye),s(Me),s(ee);var Re=v(ee,2),te=r(Re),Ue=r(te);s(te);var Ae=v(te,2),ae=r(Ae),se=r(ae),Xe=r(se);s(se);var re=v(se,2);ce(re),re.__change=()=>p(!0),s(ae);var Se=v(ae,2),le=r(Se),Je=r(le);s(le);var ie=v(le,2);ce(ie),ie.__change=()=>p(!0),s(Se),s(Ae),s(Re),s(a),x(()=>{M(Ue,`Intelligence Grade (${e(y)??""} - ${e($)??""})`),M(Xe,`Min: ${e(y)??""}`),M(Je,`Max: ${e($)??""}`)}),de(S,()=>e(R),d=>l(R,d)),de(O,()=>e(A),d=>l(A,d)),oe(re,()=>e(y),d=>l(y,d)),oe(ie,()=>e($),d=>l($,d)),ot(3,a,()=>ct,()=>({x:300,duration:300})),D(t,a)};ke(Ze,t=>{e(P)&&t(Le)})}s(we),s(L),x(()=>{vt(I,"placeholder",`Search ${e(f)==="movie"?"Movies":"TV Series"}...`),xe=V(J,1,"toggle-btn svelte-b0xv90",null,xe,{active:e(f)==="movie"}),me=V(he,1,"toggle-btn svelte-b0xv90",null,me,{active:e(f)==="tv"}),$e=V(ye,1,"filter-toggle-btn svelte-b0xv90",null,$e,{active:e(P)})}),oe(I,()=>e(m),t=>l(m,t)),de(j,()=>e(h),t=>l(h,t)),We("scroll",G,Ge),D(qe,L),st()}Ne(["click","input","change"]);export{At as component};

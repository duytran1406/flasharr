import{d as i,w as T}from"./CpQGpjHh.js";function v(){const o={settings:{download_path:"/downloads",max_concurrent_downloads:3,segments_per_download:4,rate_limit_enabled:!1,rate_limit_mbps:0,auto_extract:!1,debug_logs:!0},accounts:[],integrations:{radarr_url:"http://localhost:7878",radarr_api_key:"",radarr_enabled:!1,sonarr_url:"http://localhost:8989",sonarr_api_key:"",sonarr_enabled:!1},loading:!1,error:null,saveStatus:"idle"},{subscribe:c,set:_,update:s}=T(o),a="/api";async function g(){s(e=>({...e,loading:!0,error:null}));try{const e=await fetch(`${a}/settings`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();s(r=>({...r,settings:t.settings||r.settings,loading:!1})),console.log("[SettingsStore] Fetched settings")}catch(e){const t=e instanceof Error?e.message:"Failed to fetch settings";console.error("[SettingsStore] Fetch error:",t),s(r=>({...r,loading:!1,error:t}))}}async function d(e){s(t=>({...t,saveStatus:"saving"}));try{const t=await fetch(`${a}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return s(r=>({...r,settings:{...r.settings,...e},saveStatus:"saved"})),setTimeout(()=>{s(r=>({...r,saveStatus:"idle"}))},2e3),console.log("[SettingsStore] Settings saved"),!0}catch(t){const r=t instanceof Error?t.message:"Failed to save settings";return console.error("[SettingsStore] Save error:",r),s(n=>({...n,saveStatus:"error",error:r})),setTimeout(()=>{s(n=>({...n,saveStatus:"idle"}))},2e3),!1}}async function l(){try{const e=await fetch(`${a}/accounts`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();s(r=>({...r,accounts:t.accounts||[]})),console.log("[SettingsStore] Fetched accounts")}catch(e){console.error("[SettingsStore] Fetch accounts error:",e)}}async function f(e,t){try{const r=await fetch(`${a}/accounts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){const n=await r.json();throw new Error(n.error||`HTTP ${r.status}`)}return await l(),console.log("[SettingsStore] Account added"),!0}catch(r){const n=r instanceof Error?r.message:"Failed to add account";return console.error("[SettingsStore] Add account error:",n),s(y=>({...y,error:n})),!1}}async function h(e){try{const t=await fetch(`${a}/accounts/${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await l(),console.log("[SettingsStore] Account removed"),!0}catch(t){const r=t instanceof Error?t.message:"Failed to remove account";return console.error("[SettingsStore] Remove account error:",r),!1}}async function S(e){try{const t=await fetch(`${a}/accounts/${encodeURIComponent(e)}/refresh`,{method:"POST"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await l(),console.log("[SettingsStore] Account refreshed"),!0}catch(t){return console.error("[SettingsStore] Refresh account error:",t),!1}}async function w(e){try{const t=await fetch(`${a}/integrations/${e}/test`,{method:"POST"}),r=await t.json();return t.ok?{success:!0,message:"Connection successful"}:{success:!1,message:r.error||"Connection failed"}}catch{return{success:!1,message:"Connection failed"}}}async function m(e){try{const t=await fetch(`${a}/integrations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return s(r=>({...r,integrations:{...r.integrations,...e}})),console.log("[SettingsStore] Integrations saved"),!0}catch(t){return console.error("[SettingsStore] Save integrations error:",t),!1}}async function p(){try{const e=await fetch(`${a}/accounts`);if(!e.ok)return!1;const r=(await e.json()).accounts||[];return s(n=>({...n,accounts:r})),r.length>0}catch(e){return console.error("[SettingsStore] Check accounts error:",e),!1}}return{subscribe:c,fetchSettings:g,saveSettings:d,fetchAccounts:l,hasAccounts:p,addAccount:f,removeAccount:h,refreshAccount:S,testIntegration:w,saveIntegrations:m}}const u=v();i(u,o=>o.settings);const E=i(u,o=>o.accounts);i(u,o=>o.integrations);i(u,o=>o.loading);i(u,o=>o.saveStatus);function P(o){return new Date(o*1e3).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function k(o,c){return c===0?0:Math.round(o/c*100)}export{E as a,P as f,k as g,u as s};

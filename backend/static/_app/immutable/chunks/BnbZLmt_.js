import{a6 as u,a7 as T,W as v,w as _,v as $,x as E}from"./rK_yDtst.js";function P(){const s={settings:{download_path:"/downloads",max_concurrent_downloads:3,segments_per_download:4,rate_limit_enabled:!1,rate_limit_mbps:0,auto_extract:!1,debug_logs:!0},accounts:[],integrations:{radarr_url:"http://localhost:7878",radarr_api_key:"",radarr_enabled:!1,sonarr_url:"http://localhost:8989",sonarr_api_key:"",sonarr_enabled:!1},loading:!1,error:null,saveStatus:"idle"},{subscribe:o,set:d,update:n}=T(s),a="http://localhost:8080/api";async function g(){n(e=>({...e,loading:!0,error:null}));try{const e=await fetch(`${a}/settings`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const t=await e.json();n(r=>({...r,settings:t.settings||r.settings,loading:!1})),console.log("[SettingsStore] Fetched settings")}catch(e){const t=e instanceof Error?e.message:"Failed to fetch settings";console.error("[SettingsStore] Fetch error:",t),n(r=>({...r,loading:!1,error:t}))}}async function f(e){n(t=>({...t,saveStatus:"saving"}));try{const t=await fetch(`${a}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return n(r=>({...r,settings:{...r.settings,...e},saveStatus:"saved"})),setTimeout(()=>{n(r=>({...r,saveStatus:"idle"}))},2e3),console.log("[SettingsStore] Settings saved"),!0}catch(t){const r=t instanceof Error?t.message:"Failed to save settings";return console.error("[SettingsStore] Save error:",r),n(c=>({...c,saveStatus:"error",error:r})),setTimeout(()=>{n(c=>({...c,saveStatus:"idle"}))},2e3),!1}}async function l(){try{const e=await fetch(`${a}/accounts`);if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();n(r=>({...r,accounts:t.accounts||[]})),console.log("[SettingsStore] Fetched accounts")}catch(e){console.error("[SettingsStore] Fetch accounts error:",e)}}async function h(e,t){try{const r=await fetch(`${a}/accounts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok){const c=await r.json();throw new Error(c.error||`HTTP ${r.status}`)}return await l(),console.log("[SettingsStore] Account added"),!0}catch(r){const c=r instanceof Error?r.message:"Failed to add account";return console.error("[SettingsStore] Add account error:",c),n(w=>({...w,error:c})),!1}}async function S(e){try{const t=await fetch(`${a}/accounts/${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await l(),console.log("[SettingsStore] Account removed"),!0}catch(t){const r=t instanceof Error?t.message:"Failed to remove account";return console.error("[SettingsStore] Remove account error:",r),!1}}async function m(e){try{const t=await fetch(`${a}/accounts/${encodeURIComponent(e)}/refresh`,{method:"POST"});if(!t.ok)throw new Error(`HTTP ${t.status}`);return await l(),console.log("[SettingsStore] Account refreshed"),!0}catch(t){return console.error("[SettingsStore] Refresh account error:",t),!1}}async function p(e){try{const t=await fetch(`${a}/integrations/${e}/test`,{method:"POST"}),r=await t.json();return t.ok?{success:!0,message:"Connection successful"}:{success:!1,message:r.error||"Connection failed"}}catch{return{success:!1,message:"Connection failed"}}}async function y(e){try{const t=await fetch(`${a}/integrations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP ${t.status}`);return n(r=>({...r,integrations:{...r.integrations,...e}})),console.log("[SettingsStore] Integrations saved"),!0}catch(t){return console.error("[SettingsStore] Save integrations error:",t),!1}}return{subscribe:o,fetchSettings:g,saveSettings:f,fetchAccounts:l,addAccount:h,removeAccount:S,refreshAccount:m,testIntegration:p,saveIntegrations:y}}const i=P();u(i,s=>s.settings);const A=u(i,s=>s.accounts);u(i,s=>s.integrations);u(i,s=>s.loading);u(i,s=>s.saveStatus);function b(s){return new Date(s*1e3).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function k(s,o){return o===0?0:Math.round(s/o*100)}class x{#t=v(_([]));get accountsList(){return $(this.#t)}set accountsList(o){E(this.#t,o,!0)}constructor(){A.subscribe(o=>{this.accountsList=o})}fetch(){return i.fetchAccounts()}get primary(){return!this.accountsList||this.accountsList.length===0?null:this.accountsList.find(o=>o.is_active)||this.accountsList[0]}get primaryFormatted(){const o=this.primary;if(!o)return{email:"No Account",rank:"GUEST",expiry:"N/A",quotaPercent:0,quotaUsed:"0 GB",quotaTotal:"0 GB"};const d=o.quota_used||0,n=o.quota_total||0,a=o.valid_until||0;return{email:o.email,rank:o.rank||"VIP ACCOUNT",expiry:a>0?b(a):"N/A",quotaPercent:k(d,n),quotaUsed:(d/1024**3).toFixed(2)+" GB",quotaTotal:(n/1024**3).toFixed(2)+" GB"}}}const C=new x;export{C as a};

{% extends "base.html" %}

{% block title %}Dashboard - Fshare-Arr Bridge{% endblock %}

{% block content %}
<div class="group">
    <h2 class="group-title">Management</h2>
    <div class="grid">
        <!-- System Status Widget -->
        <div class="card widget-status">
            <div class="card-top">
                <div class="card-title-group">
                    <div class="card-icon">‚öôÔ∏è</div>
                    <div class="card-info">
                        <div class="card-title">System Status</div>
                        <div class="card-subtitle">Fshare-Arr Bridge</div>
                    </div>
                </div>
                <div class="badge badge-success">Online</div>
            </div>
            <div class="card-content">
                <p class="card-subtitle">All services operational</p>
            </div>
            <div class="card-stats">
                <div class="mini-stat">
                    <div class="mini-stat-label">Indexer</div>
                    <div class="mini-stat-value">OK</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">SABnzbd</div>
                    <div class="mini-stat-value">OK</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Uptime</div>
                    <div class="mini-stat-value">99.9%</div>
                </div>
            </div>
        </div>

        <!-- pyLoad Integration Widget -->
        <div class="card widget-pyload">
            <div class="card-top">
                <div class="card-title-group">
                    <div class="card-icon">‚è¨</div>
                    <div class="card-info">
                        <div class="card-title">pyLoad</div>
                        <div class="card-subtitle">Download Manager</div>
                    </div>
                </div>
                <div id="pyload-status-badge" class="badge badge-success">Connected</div>
            </div>
            <div class="card-content">
                <p class="card-subtitle" id="pyload-active-desc">0 active downloads</p>
            </div>
            <div class="card-stats">
                <div class="mini-stat">
                    <div class="mini-stat-label">Queue</div>
                    <div class="mini-stat-value" id="stats-active-count">0</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Speed</div>
                    <div class="mini-stat-value" id="stats-speed">0 B/s</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Total</div>
                    <div class="mini-stat-value" id="stats-total-count">0</div>
                </div>
            </div>
        </div>

        <!-- TimFshare Search Widget -->
        <div class="card widget-fshare">
            <div class="card-top">
                <div class="card-title-group">
                    <div class="card-icon">üîç</div>
                    <div class="card-info">
                        <div class="card-title">TimFshare</div>
                        <div class="card-subtitle">Search Engine</div>
                    </div>
                </div>
                <div class="badge badge-success">Ready</div>
            </div>
            <div class="card-content">
                <p class="card-subtitle">Fshare search with smart scoring</p>
            </div>
            <div class="card-stats">
                <div class="mini-stat">
                    <div class="mini-stat-label">Searches</div>
                    <div class="mini-stat-value" id="stats-search-count">0</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Success</div>
                    <div class="mini-stat-value" id="stats-success-rate">0%</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="group">
    <h2 class="group-title">Search & Utilities</h2>

    <div class="search-overlay">
        <div class="search-input-group">
            <span style="padding-left: 1rem; display: flex; align-items: center;">üîç</span>
            <input type="text" id="search-input" placeholder="Quick search Fshare..." autocomplete="off">
            <button class="btn btn-primary"
                onclick="window.location.href='/search?q=' + document.getElementById('search-input').value">Search</button>
        </div>
        <div id="search-suggestions" class="search-suggestions" style="display: none;"></div>
    </div>

    <div class="grid">
        <div class="card" style="grid-column: span 2;">
            <div class="card-top">
                <div class="card-title-group">
                    <div class="card-icon">üìú</div>
                    <div class="card-info">
                        <div class="card-title">Recent Downloads</div>
                        <div class="card-subtitle">Last few items added to queue</div>
                    </div>
                </div>
                <a href="/downloads" class="btn btn-secondary">View History</a>
            </div>
            <div class="card-content" id="downloads-list" style="margin-top: 1rem;">
                <p class="text-secondary">Loading activity...</p>
            </div>
        </div>

        <div class="card">
            <div class="card-top">
                <div class="card-title-group">
                    <div class="card-icon">üîß</div>
                    <div class="card-info">
                        <div class="card-title">Tools</div>
                        <div class="card-subtitle">Quick Actions</div>
                    </div>
                </div>
            </div>
            <div class="card-content" style="display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem;">
                <button class="btn btn-secondary" style="width: 100%; justify-content: center;">Restart Bridge</button>
                <button class="btn btn-secondary" style="width: 100%; justify-content: center;">Clear Search
                    Cache</button>
                <button class="btn btn-secondary" style="width: 100%; justify-content: center;">Scan pyLoad
                    Plugins</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Refresh stats every 30 seconds
    function refreshStats() {
        if (bridge) bridge.loadStats();
    }

    // Auto-refresh downloads every 5 seconds
    setInterval(() => {
        if (bridge) bridge.loadDownloads();
    }, 5000);

    setInterval(refreshStats, 30000);
    refreshStats();
</script>
{% endblock %}
{% extends "base.html" %}

{% block title %}Dashboard - Fshare Nexus{% endblock %}

{% block content %}
<!-- Status Grid -->
<div class="dashboard-grid">
    <!-- Network Traffic Card -->
    <div class="service-card" id="network-widget">
        <div class="service-header">
            <div class="service-icon">
                <span class="material-icons">insights</span>
            </div>
            <div class="service-title">Network Traffic</div>
            <div class="service-status">
                <span class="status-badge running" id="network-status-text">ONLINE</span>
            </div>
        </div>

        <div class="stat-row">
            <span class="stat-label">CURRENT SPEED</span>
            <span class="stat-value" id="current-speed">0 B/s</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">PEAK SPEED</span>
            <span class="stat-value" id="peak-speed">0 B/s</span>
        </div>

        <div class="network-graph-container">
            <canvas id="network-graph" height="150"></canvas>
        </div>
    </div>

    <!-- Downloader Card -->
    <div class="service-card" id="downloader-widget">
        <div class="service-header">
            <div class="service-icon">
                <span class="material-icons">cloud_download</span>
            </div>
            <div class="service-title">Fshare Downloader</div>
            <div class="service-status">
                <div class="widget-status online" id="pyload-status-indicator"></div>
            </div>
        </div>

        <div class="stat-row">
            <span class="stat-label">ACCOUNT STATUS</span>
            <span class="status-badge success" id="fshare-account-status">CHECKING...</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">ACTIVE DOWNLOADS</span>
            <span class="stat-value" id="active-downloads-count">0</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">QUEUE SIZE</span>
            <span class="stat-value" id="queue-count">0</span>
        </div>
    </div>

    <!-- Search Engine Card -->
    <div class="service-card" id="indexer-widget">
        <div class="service-header">
            <div class="service-icon">
                <span class="material-icons">manage_search</span>
            </div>
            <div class="service-title">Fshare Indexer</div>
        </div>

        <div class="stat-row">
            <span class="stat-label">API STATUS</span>
            <span class="status-badge success" id="timfshare-status">ONLINE</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">HEALTH</span>
            <span class="stat-value" id="api-health">100%</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">LATENCY</span>
            <span class="stat-value" id="api-ping">--ms</span>
        </div>
    </div>
</div>

<!-- Download Manager -->
<div class="service-card" id="active-downloads-widget" style="margin-top: 1.5rem;">
    <div class="service-header">
        <div class="service-icon">
            <span class="material-icons">download</span>
        </div>
        <div class="service-title">Active Downloads</div>
    </div>

    <div style="overflow-x: auto;">
        <table class="download-table">
            <thead>
                <tr>
                    <th onclick="bridge.sortDownloads('name')" style="cursor: pointer">
                        NAME <span class="material-icons" id="dash-sort-icon-name"
                            style="font-size: 14px; vertical-align: middle; opacity: 0.5;">swap_vert</span>
                    </th>
                    <th onclick="bridge.sortDownloads('size')" style="cursor: pointer">
                        SIZE <span class="material-icons" id="dash-sort-icon-size"
                            style="font-size: 14px; vertical-align: middle; opacity: 0.5;">swap_vert</span>
                    </th>
                    <th onclick="bridge.sortDownloads('status')" style="cursor: pointer">
                        STATUS <span class="material-icons" id="dash-sort-icon-status"
                            style="font-size: 14px; vertical-align: middle; opacity: 0.5;">swap_vert</span>
                    </th>
                    <th onclick="bridge.sortDownloads('speed')" style="cursor: pointer">
                        SPEED <span class="material-icons" id="dash-sort-icon-speed"
                            style="font-size: 14px; vertical-align: middle; opacity: 0.5;">swap_vert</span>
                    </th>
                    <th onclick="bridge.sortDownloads('progress')" style="cursor: pointer; width: 100px;">
                        PROGRESS <span class="material-icons" id="dash-sort-icon-progress"
                            style="font-size: 14px; vertical-align: middle; opacity: 0.5;">swap_vert</span>
                    </th>
                    <th style="text-align: right; padding-right: 1.5rem;">ACTIONS</th>
                </tr>
            </thead>
            <tbody id="download-manager-list">
                <tr>
                    <td colspan="6" style="text-align: center; color: var(--text-muted); padding: 2rem;">Loading
                        downloads...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- System Log -->
<div class="service-card" style="margin-top: 1.5rem;">
    <div class="service-header">
        <div class="service-icon">
            <span class="material-icons">terminal</span>
        </div>
        <div class="service-title">System Log</div>
    </div>

    <div id="system-log"
        style="font-family: 'Courier New', monospace; font-size: 0.8rem; max-height: 200px; overflow-y: auto; color: var(--text-muted);">
        <!-- Logs will be injected here -->
    </div>
</div>

<script>
    // Wake up dashboard components after SPA navigation
    if (window.bridge) {
        bridge.wakeupDashboard();
    }
</script>
{% endblock %}
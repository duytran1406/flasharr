{% extends "base.html" %}

{% block title %}Dashboard - Fshare-Arr Bridge{% endblock %}

{% block content %}
<h1 class="page-title">Dashboard</h1>

<!-- Status Widgets Row -->
<div class="dashboard-grid">
    <!-- System Status -->
    <div class="widget">
        <div class="widget-header">
            <div class="widget-title">
                <span class="widget-icon">‚öôÔ∏è</span>
                1. System Status
            </div>
            <div class="widget-status online"></div>
        </div>
        <div class="widget-content">
            <div class="widget-metric">
                <span class="metric-label">Indexer</span>
                <span class="status-badge success" id="indexer-status">STABLE</span>
            </div>
            <div class="widget-metric">
                <span class="metric-label">SABnzbd API</span>
                <span class="status-badge success" id="sabnzbd-status">READY</span>
            </div>
        </div>
    </div>

    <!-- Downloader Status -->
    <div class="widget">
        <div class="widget-header">
            <div class="widget-title">
                <span class="widget-icon">‚ö°</span>
                2. Downloader
            </div>
            <div class="widget-status online" id="pyload-status-indicator"></div>
        </div>
        <div class="widget-content">
            <div class="widget-metric">
                <span class="metric-label">Fshare Account</span>
                <span class="status-badge success" id="fshare-account-status">PREMIUM</span>
            </div>
            <div class="widget-metric">
                <span class="metric-label">Active Downloads</span>
                <span class="metric-value accent-cyan" id="active-downloads-count">08</span>
            </div>
            <div class="widget-metric">
                <span class="metric-label">Queue Count</span>
                <span class="metric-value accent-cyan" id="queue-count">154</span>
            </div>
        </div>
    </div>

    <!-- Search Engine -->
    <div class="widget">
        <div class="widget-header">
            <div class="widget-title">
                <span class="widget-icon">üîç</span>
                3. Search Engine
            </div>
            <div class="widget-status online" id="timfshare-status-indicator"></div>
        </div>
        <div class="widget-content">
            <div class="widget-metric">
                <span class="metric-label">TimFshare API</span>
                <span class="status-badge success" id="timfshare-status">ONLINE</span>
            </div>
            <div class="widget-metric">
                <span class="metric-label">Health Check</span>
                <span class="metric-value accent-green" id="api-health">100%</span>
            </div>
            <div class="widget-metric">
                <span class="metric-label">Response Time</span>
                <span class="metric-value" id="api-ping">45ms</span>
            </div>
        </div>
    </div>
</div>


<!-- Download Manager -->
<div class="widget">
    <div class="widget-header">
        <div class="widget-title">
            <span class="widget-icon">üì•</span>
            5. Download Manager
            <span style="font-size: 0.7rem; color: var(--text-muted); font-weight: 400; margin-left: 0.5rem;">
                LATEST ACTIVE PROCESSING PIPELINE
            </span>
        </div>
    </div>
    <div class="widget-content" style="padding: 0; margin-top: 1rem;">
        <table class="download-table">
            <thead>
                <tr>
                    <th>NAME</th>
                    <th>SIZE</th>
                    <th>STATUS</th>
                    <th>PROGRESS</th>
                    <th>CONTROL</th>
                </tr>
            </thead>
            <tbody id="download-manager-list">
                <tr>
                    <td>
                        <div class="download-name">Arcane.S02E02.2160p.NOR.mkv</div>
                        <div style="font-size: 0.7rem; color: var(--text-muted);">ARCANE | 2160p-NOR-01</div>
                    </td>
                    <td class="download-size">8.62 GB</td>
                    <td><span class="status-badge info">DOWNLOADING</span></td>
                    <td>
                        <div class="download-progress">
                            <div class="progress-bar" style="width: 120px;">
                                <div class="progress-fill" style="width: 78%"></div>
                            </div>
                            <span class="progress-text">78.5%</span>
                            <span style="font-size: 0.7rem; color: var(--text-muted);">12.3 MB/s</span>
                        </div>
                    </td>
                    <td>
                        <div class="download-controls">
                            <button class="icon-btn" title="Pause">‚è∏</button>
                            <button class="icon-btn delete-btn" title="Delete">üóë</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="download-name">Linux.Kernel.v6.11.Stable.tar.gz</div>
                        <div style="font-size: 0.7rem; color: var(--text-muted);">COMPLETED | 13m AGO</div>
                    </td>
                    <td class="download-size">214.5 MB</td>
                    <td><span class="status-badge success">SUCCESS</span></td>
                    <td>
                        <div class="download-progress">
                            <div class="progress-bar" style="width: 120px;">
                                <div class="progress-fill" style="width: 100%; background: var(--accent-green);"></div>
                            </div>
                            <span class="progress-text">100%</span>
                            <span style="font-size: 0.7rem; color: var(--accent-green);">VERIFIED</span>
                        </div>
                    </td>
                    <td>
                        <div class="download-controls">
                            <button class="icon-btn" title="Replay">‚Üª</button>
                            <button class="icon-btn delete-btn" title="Delete">üóë</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- System Log -->
<div class="widget" style="margin-top: 1.5rem;">
    <div class="widget-header">
        <div class="widget-title">
            <span class="widget-icon">üìã</span>
            4. System Log
        </div>
        <a href="#" class="status-badge info" style="text-decoration: none;">VIEW STREAM</a>
    </div>
    <div class="widget-content">
        <div class="log-list" id="system-log">
            <div class="log-entry info">
                <span class="log-time">[Loading...]</span>
                <span class="log-message">Fetching container logs...</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto-refresh dashboard data
    setInterval(() => {
        if (bridge) {
            bridge.loadDashboardData();
            bridge.loadDownloads();
        }
    }, 5000);
</script>
{% endblock %}